import React, { useMemo, useState } from "react";
import { I18nContext } from "./i18n-hooks";

// Re-export the hook for backward compatibility
export { useI18n } from "./i18n-hooks";

type Messages = Record<string, string>;

type I18nContextValue = {
  locale: string;
  setLocale: (next: string) => void;
  t: (key: string) => string;
};

const defaultMessages: Record<string, Messages> = {
  en: {
    "nav.features": "Features",
    "nav.how": "How It Works",
    "nav.pricing": "Pricing",
    "nav.integrations": "Integrations",
    "nav.contact": "Contact",
    "nav.login": "Log in",
    "nav.signup": "Start Free Trial",

    "seo.home.title": "FixiDesk — AI-powered helpdesk",
    "seo.home.desc": "Automate support with AI: tickets, chat, analytics, and integrations.",

    "hero.badge": "Trusted by 10,000+ businesses worldwide",
    "hero.head.pre": "Transform Customer Support with",
    "hero.head.highlight": "AI-Powered",
    "hero.head.post": "Automation",
    "hero.sub": "FixiDesk revolutionizes your helpdesk with intelligent automation, instant responses, and seamless integrations. Reduce response times by 90% and boost customer satisfaction.",
    "hero.stat.1": "90% Faster Response",
    "hero.stat.2": "24/7 Availability",
    "hero.stat.3": "98% Satisfaction Rate",
    "hero.cta.start": "Start Free Trial",
    "hero.cta.watch": "Watch Demo",
    "hero.trust": "No credit card required • 14-day free trial • Setup in minutes",
    "footer.stayUpdated": "Stay Updated",
    "footer.subscribe": "Subscribe",
    "footer.product": "Product",
    "footer.company": "Company",
    "footer.support": "Support",
    "footer.legal": "Legal",
    "footer.contactUs": "Contact Us",
    "features.header": "Powerful Features for Modern Support",
    "features.sub": "Everything you need to deliver exceptional customer support, powered by cutting-edge AI technology.",
    "features.aiAssistant.title": "AI-Powered Assistant",
    "features.aiAssistant.desc": "Advanced AI that understands context, learns from interactions, and provides accurate responses to customer queries 24/7.",
    "features.ticketRouting.title": "Intelligent Ticket Routing",
    "features.ticketRouting.desc": "Automatically categorize and route tickets to the right team members based on content analysis and priority scoring.",
    "features.analytics.title": "Real-time Analytics",
    "features.analytics.desc": "Comprehensive dashboards with performance metrics, customer satisfaction scores, and detailed reporting.",
    "features.security.title": "Enterprise Security",
    "features.security.desc": "Bank-level encryption, GDPR compliance, and advanced security features to protect your customer data.",
    "features.availability.title": "24/7 Availability",
    "features.availability.desc": "Never miss a customer query with round-the-clock automated responses and intelligent escalation.",
    "features.automation.title": "Smart Automation",
    "features.automation.desc": "Create custom workflows that automate repetitive tasks and streamline your support processes.",
    "features.fast.title": "Lightning Fast",
    "features.fast.desc": "Average response time under 2 seconds with intelligent caching and optimized AI processing.",
    "features.collaboration.title": "Team Collaboration",
    "features.collaboration.desc": "Seamless collaboration tools with internal notes, team assignments, and knowledge sharing.",
    "features.learning.title": "Continuous Learning",
    "features.learning.desc": "AI that gets smarter over time by learning from your team's responses and customer feedback.",
    "how.header": "How FixiDesk Works",
    "how.sub": "Get started in minutes with our simple three-step process. No technical expertise required.",
    "how.step1.title": "Connect Your Channels",
    "how.step1.desc": "Integrate FixiDesk with your existing email, chat, and social media channels in just a few clicks.",
    "how.step1.f1": "Email integration",
    "how.step1.f2": "Live chat widget",
    "how.step1.f3": "Social media sync",
    "how.step1.f4": "API connections",
    "how.step2.title": "Train Your AI Assistant",
    "how.step2.desc": "Upload your knowledge base, FAQs, and product documentation to train the AI on your specific business.",
    "how.step2.f1": "Knowledge base import",
    "how.step2.f2": "FAQ training",
    "how.step2.f3": "Custom responses",
    "how.step2.f4": "Brand voice tuning",
    "how.step3.title": "Automate & Monitor",
    "how.step3.desc": "Let FixiDesk handle routine queries automatically while your team focuses on complex issues.",
    "how.step3.f1": "Automated responses",
    "how.step3.f2": "Smart escalation",
    "how.step3.f3": "Performance analytics",
    "how.step3.f4": "Continuous improvement",
    "integrations.header": "Seamlessly integrates with your favorite tools",
    "integrations.sub": "From CRMs to collaboration platforms, FixiDesk connects where your work happens.",
    "integrations.ctaSub": "Connect with 1000+ apps through our platform",
    "integrations.cta": "See All Integrations",
    "pricing.header": "Simple, Transparent Pricing",
    "pricing.sub": "Choose the perfect plan for your business. All plans include a 14-day free trial with no credit card required.",
    "pricing.mostPopular": "Most Popular",
    "pricing.perMonth": "per month",
    "pricing.contactSales": "contact sales",
    "pricing.ctaStart": "Start Free Trial",
    "pricing.ctaContact": "Contact Sales",
    "pricing.plan.starter.name": "Starter",
    "pricing.plan.starter.desc": "Perfect for small teams getting started",
    "pricing.plan.starter.f1": "Up to 1,000 tickets/month",
    "pricing.plan.starter.f2": "Basic AI responses",
    "pricing.plan.starter.f3": "Email integration",
    "pricing.plan.starter.f4": "Standard support",
    "pricing.plan.starter.f5": "Basic analytics",
    "pricing.plan.starter.f6": "2 team members",
    "pricing.plan.pro.name": "Professional",
    "pricing.plan.pro.desc": "Most popular for growing businesses",
    "pricing.plan.pro.f1": "Up to 10,000 tickets/month",
    "pricing.plan.pro.f2": "Advanced AI with learning",
    "pricing.plan.pro.f3": "All channel integrations",
    "pricing.plan.pro.f4": "Priority support",
    "pricing.plan.pro.f5": "Advanced analytics",
    "pricing.plan.pro.f6": "10 team members",
    "pricing.plan.pro.f7": "Custom workflows",
    "pricing.plan.pro.f8": "API access",
    "pricing.plan.ent.name": "Enterprise",
    "pricing.plan.ent.desc": "For large organizations with custom needs",
    "pricing.plan.ent.f1": "Unlimited tickets",
    "pricing.plan.ent.f2": "Custom AI training",
    "pricing.plan.ent.f3": "White-label solution",
    "pricing.plan.ent.f4": "Dedicated support",
    "pricing.plan.ent.f5": "Advanced integrations",
    "pricing.plan.ent.f6": "Unlimited team members",
    "pricing.plan.ent.f7": "Custom security",
    "pricing.plan.ent.f8": "SLA guarantees",
    "pricing.bottom": "All plans include our core features, 24/7 AI assistant, and enterprise-grade security.",
    "contact.header": "Ready to Transform Your Support?",
    "contact.sub": "Get started with FixiDesk today. Book a demo, start your free trial, or contact our team for a personalized consultation.",
    "contact.b1": "14-day free trial",
    "contact.b2": "No credit card required",
    "contact.b3": "Setup in under 10 minutes",
    "contact.b4": "24/7 support included",
    "contact.form.title": "Get in Touch",
    "contact.form.first": "First Name",
    "contact.form.last": "Last Name",
    "contact.form.email": "Email",
    "contact.form.company": "Company",
    "contact.form.message": "Message",
    "contact.form.placeholder": "Tell us about your needs...",
    "contact.form.sending": "Sending...",
    "contact.form.cta": "Send Message",
    "contact.form.sentTitle": "Message Sent!",
    "contact.form.sentDesc": "Thank you for contacting us. We'll get back to you within 24 hours.",
    "contact.toast.title": "Message sent!",
    "contact.toast.desc": "We'll get back to you within 24 hours.",
  },
  hi: {
    "nav.features": "विशेषताएँ",
    "nav.how": "कैसे काम करता है",
    "nav.pricing": "मूल्य",
    "nav.integrations": "इंटीग्रेशंस",
    "nav.contact": "संपर्क",
    "nav.login": "लॉग इन",
    "nav.signup": "मुफ़्त ट्रायल शुरू करें",

    "seo.home.title": "FixiDesk — एआई संचालित हेल्पडेस्क",
    "seo.home.desc": "एआई के साथ सपोर्ट ऑटोमेट करें: टिकट, चैट, एनालिटिक्स और इंटीग्रेशंस।",

    "hero.badge": "दुनिया भर में 10,000+ व्यवसायों का भरोसा",
    "hero.head.pre": "कस्टमर सपोर्ट को बदलें",
    "hero.head.highlight": "एआई-पावर्ड",
    "hero.head.post": "ऑटोमेशन के साथ",
    "hero.sub": "FixiDesk आपके हेल्पडेस्क को स्मार्ट ऑटोमेशन, त्वरित जवाब और सहज इंटीग्रेशंस के साथ बदल देता है। 90% तक प्रतिक्रिया समय घटाएँ और ग्राहक संतुष्टि बढ़ाएँ।",
    "hero.stat.1": "90% तेज़ प्रतिक्रिया",
    "hero.stat.2": "24/7 उपलब्ध",
    "hero.stat.3": "98% संतुष्टि दर",
    "hero.cta.start": "मुफ़्त ट्रायल शुरू करें",
    "hero.cta.watch": "डेमो देखें",
    "hero.trust": "क्रेडिट कार्ड की ज़रूरत नहीं • 14-दिन का फ़्री ट्रायल • मिनटों में सेटअप",
    "footer.stayUpdated": "अपडेट रहें",
    "footer.subscribe": "सब्सक्राइब करें",
    "footer.product": "उत्पाद",
    "footer.company": "कंपनी",
    "footer.support": "सहायता",
    "footer.legal": "कानूनी",
    "footer.contactUs": "हमसे संपर्क करें",
    "features.header": "आधुनिक सपोर्ट के लिए शक्तिशाली फीचर्स",
    "features.sub": "उत्कृष्ट ग्राहक सहायता देने के लिए हर वह चीज़, अत्याधुनिक एआई तकनीक के साथ।",
    "features.aiAssistant.title": "एआई-पावर्ड असिस्टेंट",
    "features.aiAssistant.desc": "उन्नत एआई जो संदर्भ समझता है, इंटरैक्शन से सीखता है और 24/7 सटीक जवाब देता है।",
    "features.ticketRouting.title": "इंटेलिजेंट टिकट रूटिंग",
    "features.ticketRouting.desc": "कंटेंट और प्राथमिकता के आधार पर टिकट्स को सही टीम तक स्वतः भेजें।",
    "features.analytics.title": "रियल-टाइम एनालिटिक्स",
    "features.analytics.desc": "प्रदर्शन मेट्रिक्स, संतुष्टि स्कोर और विस्तृत रिपोर्टिंग के साथ व्यापक डैशबोर्ड।",
    "features.security.title": "एंटरप्राइज़ सुरक्षा",
    "features.security.desc": "बैंक-स्तरीय एन्क्रिप्शन, GDPR अनुपालन और उन्नत सुरक्षा फीचर्स से डेटा सुरक्षित रखें।",
    "features.availability.title": "24/7 उपलब्धता",
    "features.availability.desc": "दिन-रात ऑटोमेटेड जवाब और स्मार्ट एस्केलेशन के साथ कोई क्वेरी न छूटे।",
    "features.automation.title": "स्मार्ट ऑटोमेशन",
    "features.automation.desc": "कस्टम वर्कफ़्लो बनाएं जो दोहराए जाने वाले कार्यों को ऑटोमेट करें और सपोर्ट को सरल बनाएं।",
    "features.fast.title": "बेहद तेज़",
    "features.fast.desc": "इंटेलिजेंट कैशिंग और ऑप्टिमाइज़्ड एआई प्रोसेसिंग से 2 सेकंड से कम का औसत जवाब समय।",
    "features.collaboration.title": "टीम सहयोग",
    "features.collaboration.desc": "इंटरनल नोट्स, असाइनमेंट और नॉलेज शेयरिंग के साथ सहज सहयोग।",
    "features.learning.title": "लगातार सीखना",
    "features.learning.desc": "आपकी टीम के जवाबों और फ़ीडबैक से सीखकर एआई समय के साथ बेहतर होता जाता है।",
    "how.header": "FixiDesk कैसे काम करता है",
    "how.sub": "हमारी सरल ���ीन-स्टेप प्रक्रिया के साथ मिनटों में शुरू करें। किसी तकनीकी विशेषज्ञता की आवश्यकता नहीं।",
    "how.step1.title": "अपने चैनल कनेक्ट करें",
    "how.step1.desc": "कुछ क्लिक में ईमेल, चैट और सोशल मीडिया चैनल्स के साथ FixiDesk इंटीग्रेट करें।",
    "how.step1.f1": "ईमेल इंटीग्रेशन",
    "how.step1.f2": "लाइव चैट विजेट",
    "how.step1.f3": "सोशल मीडिया सिंक",
    "how.step1.f4": "API कनेक्शन",
    "how.step2.title": "अपने एआई असिस्टेंट को ट्रेन करें",
    "how.step2.desc": "नॉलेज बेस, FAQ और प्रोडक्ट डॉक्यूमेंटेशन अपलोड करके एआई को आपके व्यवसाय के अनुसार ट्रेन करें।",
    "how.step2.f1": "नॉलेज बेस इंपोर्ट",
    "how.step2.f2": "FAQ ट्रेनिंग",
    "how.step2.f3": "कस्टम जवाब",
    "how.step2.f4": "ब्रांड वॉयस ट्यूनिंग",
    "how.step3.title": "ऑटोमेट करें और मॉनिटर करें",
    "how.step3.desc": "रूटीन क्वेरीज़ को FixiDesk अपने आप संभाले, जबकि आपकी टीम जटिल मुद्दों पर ध्यान दे।",
    "how.step3.f1": "ऑटोमेटेड जवाब",
    "how.step3.f2": "स्मार्ट एस्केलेशन",
    "how.step3.f3": "प्रदर्शन एनालिटिक्स",
    "how.step3.f4": "निरंतर सुधार",
    "integrations.header": "आपके पसंदीदा टूल्स के साथ सहज इंटीग्रेशन",
    "integrations.sub": "CRM से लेकर सहयोग प्लेटफ़ॉर्म तक, FixiDesk वहीं कनेक्ट करता है जहाँ आप काम करते हैं।",
    "integrations.ctaSub": "हमारे प्लेटफ़ॉर्म के माध्यम से 1000+ ऐप्स से कनेक्ट करें",
    "integrations.cta": "सभ�� इंटीग्रेशन देखें",
    "pricing.header": "सरल, पारदर्शी मूल्य",
    "pricing.sub": "अपने व्यवसाय के लिए सही प्लान चुनें। सभी प्लान 14-दिन के फ़्री ट्रायल के साथ, बिना क्रेडिट कार्ड।",
    "pricing.mostPopular": "सबसे लोकप्रिय",
    "pricing.perMonth": "प्रति माह",
    "pricing.contactSales": "सेल्स से संपर्क करें",
    "pricing.ctaStart": "मुफ़्त ट्रायल शुरू करें",
    "pricing.ctaContact": "सेल्स से संपर्क करें",
    "pricing.plan.starter.name": "स्टार्टर",
    "pricing.plan.starter.desc": "शुरू करने वाली छोटी टीमों के लिए उपयुक्त",
    "pricing.plan.starter.f1": "1,000 टिकट/माह तक",
    "pricing.plan.starter.f2": "बेसिक एआई जवाब",
    "pricing.plan.starter.f3": "ईमेल इंटीग्रेशन",
    "pricing.plan.starter.f4": "स्टैंडर्ड सपोर��ट",
    "pricing.plan.starter.f5": "बेसिक एनालिटिक्स",
    "pricing.plan.starter.f6": "2 टीम मेंबर्स",
    "pricing.plan.pro.name": "प्रोफेशनल",
    "pricing.plan.pro.desc": "बढ़ते व्यवसायों के लिए सबसे लोकप्रिय",
    "pricing.plan.pro.f1": "10,000 टिकट/माह तक",
    "pricing.plan.pro.f2": "लर्निंग के साथ उन्नत एआई",
    "pricing.plan.pro.f3": "सभी चैनल इंटीग्रेशन",
    "pricing.plan.pro.f4": "प्रायोरिटी सपोर्ट",
    "pricing.plan.pro.f5": "उन्नत एनालिटिक्स",
    "pricing.plan.pro.f6": "10 टीम मेंबर्स",
    "pricing.plan.pro.f7": "कस्टम वर्कफ़्लोज़",
    "pricing.plan.pro.f8": "API एक्सेस",
    "pricing.plan.ent.name": "एंटरप्राइज़",
    "pricing.plan.ent.desc": "कस्टम आवश्यकताओं वाली बड़ी संस्थाओं के लिए",
    "pricing.plan.ent.f1": "अनलिमिटेड टिकट",
    "pricing.plan.ent.f2": "कस्टम एआई ट्रेनिंग",
    "pricing.plan.ent.f3": "व्हाइट-लेबल समाधान",
    "pricing.plan.ent.f4": "समर्पित सपोर्ट",
    "pricing.plan.ent.f5": "उन्नत इंटीग्रेशन",
    "pricing.plan.ent.f6": "अनलिमिटेड टीम मेंबर्स",
    "pricing.plan.ent.f7": "कस्टम सुरक्षा",
    "pricing.plan.ent.f8": "SLA गारंटी",
    "pricing.bottom": "सभी प्लान में हमारे मुख्य फीचर्स, 24/7 एआई असिस्टेंट और एंटरप्राइज़-ग्रेड सुरक्षा शामिल है।",
    "contact.header": "क्या आप अपने सपोर्ट को बदलने के लिए तैयार हैं?",
    "contact.sub": "आज ही FixiDesk के साथ शुरू करें। डेमो बुक करें, मुफ़्त ट्रायल शुरू करें, या हमारी टीम से व्यक्तिगत सलाह के लिए संपर्क करें।",
    "contact.b1": "14-दिन का फ़्री ट्रायल",
    "contact.b2": "क्रेडिट कार्ड की ज़रूरत नहीं",
    "contact.b3": "10 मिनट से कम में सेटअप",
    "contact.b4": "24/7 सपोर्ट शामिल",
    "contact.form.title": "हमसे संपर्क करें",
    "contact.form.first": "पहला नाम",
    "contact.form.last": "अंतिम नाम",
    "contact.form.email": "ईमेल",
    "contact.form.company": "कंपनी",
    "contact.form.message": "संदेश",
    "contact.form.placeholder": "अपनी ज़रूरतों के बारे में बताएं...",
    "contact.form.sending": "भेजा जा रहा है...",
    "contact.form.cta": "संदेश भेजें",
    "contact.form.sentTitle": "संदेश भेज दिया गया!",
    "contact.form.sentDesc": "हमसे संपर्क करने के लिए धन्यवाद। हम 24 घंटे के भीतर वापस आएंगे।",
    "contact.toast.title": "संदेश भेजा गया!",
    "contact.toast.desc": "हम 24 घंटे के भीतर आपसे संपर्क करेंगे।",
  },
};

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const getInitial = () => {
    const stored = typeof window !== 'undefined' ? localStorage.getItem('locale') : null;
    if (stored && defaultMessages[stored]) return stored;
    const nav = typeof navigator !== 'undefined' ? navigator.language : 'en';
    if (nav?.toLowerCase().startsWith('hi')) return 'hi';
    return 'en';
  };
  const [locale, _setLocale] = useState<string>(getInitial());

  const setLocale = (next: string) => {
    _setLocale(next);
    try { localStorage.setItem('locale', next); } catch {}
  };

  const value = useMemo<I18nContextValue>(() => ({
    locale,
    setLocale,
    t: (key: string) => {
      const table = defaultMessages[locale] ?? {};
      const sanitizedKey = key.replace(/[<>"'&]/g, '');
      const result = table[sanitizedKey] ?? sanitizedKey;
      return typeof result === 'string'
        ? result.replace(/[<>"'&]/g, (match) => {
            const escapeMap: Record<string, string> = {
              '<': '&lt;',
              '>': '&gt;',
              '"': '&quot;',
              "'": '&#x27;',
              '&': '&amp;'
            };
            return escapeMap[match] || match;
          })
        : result;
    },
  }), [locale]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}
